"use strict";importScripts("db.js");var pushContent=function(e){navigator.onLine&&(dbPromise=idb.open("restaurant",1),pushReviews(dbPromise),pushFavorites(dbPromise))},pushReviews=function(e){e&&e.then(function(n){if(!n)return null;var r=n.transaction("savedReviews","readwrite");r.objectStore("savedReviews").index("by-id").getAll().then(function(e){if(e.length<1)return null;e.forEach(function(t){var e={restaurant_id:parseInt(t.restaurant_id),comments:t.comments,name:t.name,rating:t.rating};fetch(DBHelper.DATABASE_URL("reviews"),{method:"POST",body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){(r=n.transaction("savedReviews","readwrite")).objectStore("savedReviews").delete(t.id)}).catch(function(e){return console.error(e)})})})})},pushFavorites=function(e){e&&e.then(function(n){if(!n)return null;var r=n.transaction("savedFavorites","readwrite");r.objectStore("savedFavorites").index("by-restaurant").getAll().then(function(e){if(e.length<1)return null;e.forEach(function(e){var t="restaurants/"+e.restaurant_id+"/?is_favorite="+JSON.parse(e.is_favorite);fetch(DBHelper.DATABASE_URL(t),{method:"PUT"}).then(function(e){return e.json()}).then(function(e){(r=n.transaction("savedFavorites","readwrite")).objectStore("savedFavorites").delete(e.id)}).catch(function(e){return console.error(e)})})})})};self.onmessage=pushContent();